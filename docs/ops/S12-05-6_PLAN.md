# S12-05.6 PLAN — prverify stopless hardening

**Branch**: `s12-05-6-prverify-stopless-fix-v1`

**Goal**: `cmd/prverify/main.go` を stopless にし、CPU/挙動の地雷を除去する。

**Invariants**
- exit系禁止（`os.Exit` 全撤去）
- stdout は `OK:` / `ERROR:` / `SKIP:` / `PASS:` のみ（機械可読）
- CI デフォルト経路は変えない（`full` モードの手順は維持）

---

## 地雷観測ログ（Discovery: 2026-02-24）

| Blocker                         | Location                  | Status                                |
| ------------------------------- | ------------------------- | ------------------------------------- |
| A: os.Exit(1)                   | cmd/prverify/main.go L437 | **FIX**                               |
| B: ERROR: stderr-only           | 複数箇所                  | **FIX: stdout に寄せる**              |
| C: dep-guard cmd.Run() 二重実行 | L339                      | **Audit-SKIP: single-run 確認済み**   |
| D: git diff cmd.Dir 未指定      | L810                      | **Audit-SKIP: cmd.Dir=root 設定済み** |

---

## Pseudocode

```
hasError := false

reportFail := func(step) {
  hasError = true
  steps = append(steps, step)
}

IF os.Exit が存在 → 撤去 → hasError フラグ方式へ置換

IF ERROR: が stderr のみ → stdout へ寄せる（二重出力: stdout = 正）

TRY dep-guard 実行
  IF cmd.Run() が二重 → SKIP (already single-run)

TRY git diff
  IF cmd.Dir=root 未指定 → SKIP (already set)

実行途中で失敗しても プロセス継続
  reportFail(step)
  hasError=true
  後続の重いステップへ進まない

最後に必ず:
  stopVal := 0; if hasError { stopVal = 1 }
  fmt.Printf("OK: phase=end stop=%d\n", stopVal)
  print renderMarkdown(...)
  IF !hasError → "PASS: All checks passed."
```
