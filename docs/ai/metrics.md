# Metrics v1 (SSOT)

This document defines the Single Source of Truth for `dist/metrics/v1/` artifacts.
These files are machine-readable outputs generated by Cockpit commands.

## Contract

1.  **Versioned Path**: Always write to `dist/metrics/v1/`.
2.  **Format**: JSON.
3.  **Persistence**: `check.json` MUST be written even if the command fails (best-effort).
4.  **Schema Stability**: Strictly additive changes only.

## Schemas

### `check.json`

Generated by `nix run .#check`. Captures the result of the validation run.

```json
{
  "metrics_version": "v1",
  "command": "check",
  "result": "pass|fail",
  "timestamp": "2025-12-23T12:00:00Z", // Optional in CI to reduce diff noise if needed
  "git": {
    "sha": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
    "dirty": false
  },
  "reasons": [
    {
      "code": "GIT_MISSING",
      "reason": "git is required but not found",
      "fix": "Install git, or enter nix develop",
      "docs": "docs/ai/SSOT.md#git-required"
    }
  ]
}
```

### `summary.json`

(Reserved for future aggregation metrics. e.g., daily coverage stats, flake usage stats.)

```json
{
  "metrics_version": "v1",
  "type": "summary",
  "data": {}
}
```

## RFv1 (Reason/Fix v1)

For stdout/stderr, we simply print logs using the RFv1 format (Machine Readable lines + Human Readable block).
See `internal/ux/reasonfix.go` for implementation.
