# ==============================================================================
# pii_jp.toml — veil default rules (schema v1)
# De-facto JP PII pack (practical + strong) — 2025-12-29
#
# Philosophy:
# - PII leaks are "damage-in-progress": default action should be MASK + WARN.
# - Infra secrets are "instant-death": those belong in cloud_keys/formats (FAIL).
# - Here we focus on JP-specific personal identifiers + "oops, I printed it" fields.
#
# Design choices:
# - Prefer keyword-bound rules (e.g. "口座番号: 1234567") to reduce false positives.
# - Provide a small set of "unlabeled" catchers for common formats (email, MAC, IP).
# - Provide a final heuristic rule: "if it looks like an ID and is labeled like an ID".
#
# Customization (copy-paste friendly):
# - Add your org-specific member/customer IDs under [CUSTOM EXAMPLES] section.
# - To tighten: raise severity/score, or add more keywords.
# - To relax: lower severity/score, or restrict with keywords.
#
# Notes about Rust regex:
# - No look-around / backreferences. Keep patterns simple & keyword-biased.
# ==============================================================================

[pack]
id = "default.pii_jp"
schema_version = 1
version = 1
description = "Japan-specific PII rules for veil default pack (de-facto strong baseline)"

# ------------------------------------------------------------------------------
# 1) Government / Identity (JP)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.jp.mynumber.keyword"
description = "My Number (12 digits) with keyword context"
pattern = '''(?:(?:基礎)?マイナンバー|個人番号|My\s*Number)[^0-9]{0,24}[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}'''
severity = "HIGH"
score = 92
category = "pii"
tags = ["jp", "mynumber", "government"]
base_score = 92
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.mynumber.unlabeled"
description = "My Number (12 digits) unlabeled (higher FP risk)"
pattern = '''[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}'''
severity = "MEDIUM"
score = 72
category = "pii"
tags = ["jp", "mynumber", "heuristic"]
base_score = 72
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.pension.basic_number"
description = "Basic pension number (10 digits) with keyword context"
pattern = '''(?:基礎年金番号|年金手帳)[^0-9]{0,24}[0-9]{4}[- ]?[0-9]{6}'''
severity = "HIGH"
score = 85
category = "pii"
tags = ["jp", "pension", "government"]
base_score = 85
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.driver_license.number"
description = "JP driver license number (12 digits) with keyword context"
pattern = '''(?:運転免許|免許証|免許番号|driver(?:\s*|_)?license)[^0-9]{0,24}[0-9]{12}'''
severity = "HIGH"
score = 86
category = "pii"
tags = ["jp", "driver_license", "id"]
base_score = 86
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.passport.number"
description = "Passport number (JP commonly 2 letters + 7 digits) with keyword context"
pattern = '''(?:パスポート|passport)[^A-Z0-9]{0,24}[A-Z]{2}[0-9]{7}'''
severity = "HIGH"
score = 82
category = "pii"
tags = ["passport", "id"]
base_score = 82
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 2) Contact
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.jp.phone.mobile"
description = "JP mobile phone number (070/080/090)"
pattern = '''0[789]0[- ]?[0-9]{4}[- ]?[0-9]{4}'''
severity = "MEDIUM"
score = 66
category = "pii"
tags = ["jp", "phone", "mobile"]
base_score = 66
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.phone.landline.keyword"
description = "JP landline phone number with keyword context (looser pattern)"
pattern = '''(?:電話|TEL|Tel|Phone)[^0-9]{0,12}0[1-9][0-9]{0,3}[- ]?[0-9]{1,4}[- ]?[0-9]{3,4}'''
severity = "LOW"
score = 45
category = "pii"
tags = ["jp", "phone", "landline", "heuristic"]
base_score = 45
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.net.email"
description = "Email address"
pattern = '''[A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[A-Za-z]{2,}'''
severity = "MEDIUM"
score = 60
category = "pii"
tags = ["email"]
base_score = 60
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 3) Location
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.jp.postal_code"
description = "JP postal code (NNN-NNNN)"
pattern = '''[0-9]{3}-?[0-9]{4}'''
severity = "LOW"
score = 34
category = "pii"
tags = ["jp", "postal"]
base_score = 34
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.address.prefecture_heuristic"
description = "JP address heuristic (prefecture + city/ward + block numbers)"
pattern = '''(?:北海道|青森県|岩手県|宮城県|秋田県|山形県|福島県|茨城県|栃木県|群馬県|埼玉県|千葉県|東京都|神奈川県|新潟県|富山県|石川県|福井県|山梨県|長野県|岐阜県|静岡県|愛知県|三重県|滋賀県|京都府|大阪府|兵庫県|奈良県|和歌山県|鳥取県|島根県|岡山県|広島県|山口県|徳島県|香川県|愛媛県|高知県|福岡県|佐賀県|長崎県|熊本県|大分県|宮崎県|鹿児島県|沖縄県)[^\n]{0,40}(?:市|区|町|村)[^\n]{0,40}[0-9]{1,3}[-丁目 ]?[0-9]{1,3}(?:[- ]?[0-9]{1,3})?'''
severity = "LOW"
score = 40
category = "pii"
tags = ["jp", "address", "heuristic"]
base_score = 40
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.geo.latlon.rough"
description = "Latitude/Longitude (rough decimal degrees)"
pattern = '''-?(?:[0-8]?[0-9]\.\d{4,}|90\.0{4,})\s*,\s*-?(?:1[0-7][0-9]\.\d{4,}|[0-9]{1,2}\.\d{4,}|180\.0{4,})'''
severity = "MEDIUM"
score = 62
category = "pii"
tags = ["gps", "geo"]
base_score = 62
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 4) Financial
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.fin.credit_card.keyword"
description = "Credit card number (major brands) with keyword context"
pattern = '''(?:(?:クレジット|カード|credit|card|VISA|Mastercard|AMEX|JCB|Diners|Discover)[^\n]{0,24})(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|35[0-9]{14}|6(?:011|5[0-9]{2})[0-9]{12})'''
severity = "HIGH"
score = 90
category = "pii"
tags = ["payment", "card"]
base_score = 90
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.fin.bank_account.keyword"
description = "Bank account number with keyword context (JP common 7 digits)"
pattern = '''(?:口座番号|口座|account(?:\s*|_)?number|acct(?:\s*|_)?no)[^0-9]{0,24}[0-9]{6,8}'''
severity = "HIGH"
score = 84
category = "pii"
tags = ["bank", "account"]
base_score = 84
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.fin.bank_holder.keyword"
description = "Account holder name (keyword-bound)"
pattern = '''(?:口座名義|名義人|account(?:\s*|_)?holder|holder)[^\n]{0,8}[ 　]*[:：]?[ 　]*[A-Za-zァ-ヺぁ-ゖ一-龯][A-Za-zァ-ヺぁ-ゖ一-龯 　]{1,40}'''
severity = "MEDIUM"
score = 65
category = "pii"
tags = ["bank", "name"]
base_score = 65
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 5) Network / Device identifiers
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.net.ipv4"
description = "IPv4 address"
pattern = '''(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)'''
severity = "MEDIUM"
score = 55
category = "pii"
tags = ["ip", "network"]
base_score = 55
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.net.ipv6"
description = "IPv6 address (common forms)"
pattern = '''(?i)\b(?:[0-9a-f]{1,4}:){2,7}[0-9a-f]{1,4}\b'''
severity = "MEDIUM"
score = 58
category = "pii"
tags = ["ip", "ipv6", "network"]
base_score = 58
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.device.mac"
description = "MAC address"
pattern = '''(?i)(?:[0-9a-f]{2}[:-]){5}[0-9a-f]{2}'''
severity = "MEDIUM"
score = 60
category = "pii"
tags = ["mac", "device"]
base_score = 60
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 6) Person / Profile fields (keyword-bound)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.person.name.keyword"
description = "Person name field (JP/EN keyword-bound)"
pattern = '''(?:氏名|名前|お名前|Name|name)[^\n]{0,6}[ 　]*[:：]?[ 　]*[A-Za-zァ-ヺぁ-ゖ一-龯][A-Za-zァ-ヺぁ-ゖ一-龯 　]{1,40}'''
severity = "LOW"
score = 38
category = "pii"
tags = ["name", "profile", "heuristic"]
base_score = 38
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.person.age.keyword"
description = "Age field (keyword-bound)"
pattern = '''(?:年齢|Age|age)[^\d]{0,6}([0-9]{1,3})\s*(?:歳|才|years?)?'''
severity = "LOW"
score = 28
category = "pii"
tags = ["age", "profile"]
base_score = 28
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.person.gender.keyword"
description = "Gender field (keyword-bound)"
pattern = '''(?:性別|Gender|gender)[^\n]{0,8}(?:男|女|男性|女性|M|F|male|female|man|woman)'''
severity = "LOW"
score = 28
category = "pii"
tags = ["gender", "profile"]
base_score = 28
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.org.company_name.keyword"
description = "Company/Organization name field (keyword-bound)"
pattern = '''(?:会社名|企業名|組織名|organization|org(?:\s*|_)?name|company(?:\s*|_)?name)[^\n]{0,8}[ 　]*[:：]?[ 　]*[A-Za-zァ-ヺぁ-ゖ一-龯][A-Za-z0-9ァ-ヺぁ-ゖ一-龯 　\-\._]{1,60}'''
severity = "LOW"
score = 30
category = "pii"
tags = ["company", "org", "profile"]
base_score = 30
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 7) IDs (student/employee/customer/member), Product/Serial
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.id.student_employee.keyword"
description = "Student/Employee ID (keyword-bound)"
pattern = '''(?:学籍番号|学生番号|社員番号|従業員番号|employee(?:\s*|_)?id|staff(?:\s*|_)?id|student(?:\s*|_)?id)[^\n]{0,12}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-_]{3,31}'''
severity = "MEDIUM"
score = 58
category = "pii"
tags = ["id", "student", "employee"]
base_score = 58
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.id.customer_member.keyword"
description = "Customer/Member ID (keyword-bound)"
pattern = '''(?:顧客番号|会員ID|会員番号|メンバーID|ユーザーID|customer(?:\s*|_)?id|member(?:\s*|_)?id|user(?:\s*|_)?id)[^\n]{0,12}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-_]{3,31}'''
severity = "MEDIUM"
score = 58
category = "pii"
tags = ["id", "customer", "member"]
base_score = 58
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.product.serial.keyword"
description = "Product serial/model number (keyword-bound)"
pattern = '''(?:製品番号|型番|モデル|model|serial|シリアル|S/N|SN)[^\n]{0,12}[:：]?[ 　]*[A-Z0-9][A-Z0-9\-_]{5,39}'''
severity = "LOW"
score = 42
category = "pii"
tags = ["product", "serial", "inventory"]
base_score = 42
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 8) Payments / Tokens / Transaction IDs (keyword-bound)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.pay.token.keyword"
description = "Payment token / session token (keyword-bound, base64-ish / opaque)"
pattern = '''(?:決済|支払い|payment|pay|token|セッション|session)[^\n]{0,16}[:：]?[ 　]*[A-Za-z0-9_\-]{16,128}'''
severity = "HIGH"
score = 80
category = "pii"
tags = ["payment", "token", "opaque"]
base_score = 80
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.pay.txid.keyword"
description = "Transaction ID (keyword-bound, hex 32-64)"
pattern = '''(?:トランザクション|TXID|txid|transaction(?:\s*|_)?id)[^\n]{0,16}[:：]?[ 　]*(?i)[0-9a-f]{32,64}'''
severity = "MEDIUM"
score = 70
category = "pii"
tags = ["payment", "txid", "crypto_like"]
base_score = 70
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 9) JP vehicle plate (stack leak + personal trace)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.jp.vehicle.plate"
description = "JP vehicle plate-ish (region + class + kana + number)"
pattern = '''(?:[一-龯]{2,3}[ 　]*)?[0-9]{1,3}[ 　]*[ぁ-ゖァ-ヺ][ 　]*[0-9]{1,2}-[0-9]{2}'''
severity = "LOW"
score = 35
category = "pii"
tags = ["jp", "vehicle", "plate", "heuristic"]
base_score = 35
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# 10) FINAL BOSS: "If it's labeled like an ID, stop it."
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.heuristic.number_like.keyword"
description = "Number-like token with ID-ish keywords (last resort gate)"
pattern = '''(?:番号|ID|No\.|NO\.|no\.|コード|code|伝票|注文|受付|アカウント|account)[^\n]{0,16}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-]{7,39}'''
severity = "MEDIUM"
score = 62
category = "pii"
tags = ["heuristic", "number_like", "gate"]
base_score = 62
context_lines_before = 1
context_lines_after = 1

# ==============================================================================
# [CUSTOM EXAMPLES] — copy-paste and edit
# ==============================================================================
#
# Example A: Your member ID looks like "CUS-123456" (tight).
#
# [[rules]]
# id = "custom.jp.customer_id.cus"
# description = "Custom customer id (CUS-######)"
# pattern = '''\bCUS-[0-9]{6}\b'''
# severity = "HIGH"
# score = 80
# category = "pii"
# tags = ["custom", "customer_id"]
# base_score = 80
# context_lines_before = 1
# context_lines_after = 1
#
# Example B: Your ticket ids look like "TKT_2025_XXXXXX" (semi-structured).
#
# [[rules]]
# id = "custom.jp.ticket_id.tkt"
# description = "Custom ticket id"
# pattern = '''\bTKT_[0-9]{4}_[A-Z0-9]{6,12}\b'''
# severity = "MEDIUM"
# score = 60
# category = "pii"
# tags = ["custom", "ticket"]
# base_score = 60
# context_lines_before = 1
# context_lines_after = 1
#
# Example C: Relax false positives for postal code by making it keyword-bound.
# - Replace pii.jp.postal_code with:
#
# [[rules]]
# id = "custom.jp.postal_code.keyword"
# description = "JP postal code keyword-bound"
# pattern = '''(?:〒|郵便番号|zip)[^\d]{0,8}[0-9]{3}-?[0-9]{4}'''
# severity = "LOW"
# score = 25
# category = "pii"
# tags = ["custom", "postal"]
# base_score = 25
# context_lines_before = 1
# context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: Birthdate / DOB
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.jp.birthdate.keyword"
description = "Birthdate / DOB (keyword-bound, yyyy-mm-dd / yyyy/mm/dd / yyyy年mm月dd日)"
pattern = '''(?:生年月日|誕生日|DOB|Birth(?:\s*|_)?date)[^\d]{0,16}(?:19|20)[0-9]{2}[-/年 ]?(?:0?[1-9]|1[0-2])[-/月 ]?(?:0?[1-9]|[12][0-9]|3[01])(?:日)?'''
severity = "MEDIUM"
score = 62
category = "pii"
tags = ["jp", "birthdate", "dob"]
base_score = 62
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.jp.birthdate.era.keyword"
description = "Birthdate (JP era: 昭和/平成/令和, keyword-bound)"
pattern = '''(?:生年月日|誕生日)[^\n]{0,16}(?:昭和|平成|令和)\s*[0-9]{1,2}\s*年\s*(?:0?[1-9]|1[0-2])\s*月\s*(?:0?[1-9]|[12][0-9]|3[01])\s*日'''
severity = "LOW"
score = 45
category = "pii"
tags = ["jp", "birthdate", "era"]
base_score = 45
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: Cash card / ATM card number (context-bound)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.fin.cash_card.number.keyword"
description = "Cash/ATM card number (keyword-bound; 12-19 digits, spaced/hyphen ok)"
pattern = '''(?:キャッシュカード|ATMカード|cash(?:\s*|_)?card|atm(?:\s*|_)?card)[^\n]{0,24}(?:[0-9]{4}[- ]?){2,4}[0-9]{1,4}'''
severity = "HIGH"
score = 82
category = "pii"
tags = ["payment", "cash_card"]
base_score = 82
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: Securities / Brokerage numbers
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.fin.securities.account.keyword"
description = "Securities/brokerage account number (keyword-bound)"
pattern = '''(?:証券番号|証券口座|証券口座番号|取引口座|brokerage(?:\s*|_)?account|securities(?:\s*|_)?account)[^\n]{0,16}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-_]{5,23}'''
severity = "MEDIUM"
score = 65
category = "pii"
tags = ["securities", "account", "id"]
base_score = 65
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: E-money IDs / wallet IDs (context-bound)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.pay.emoney_id.keyword"
description = "E-money / wallet id (keyword-bound; JP brands included)"
pattern = '''(?:電子マネー|e-?money|ウォレット|wallet|決済ID|支払いID|Suica|PASMO|ICOCA|nanaco|WAON|PayPay|LINE\s*Pay|楽天ペイ|Rakuten\s*Pay|au\s*PAY|d払い|メルペイ)[^\n]{0,16}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-_]{7,63}'''
severity = "MEDIUM"
score = 68
category = "pii"
tags = ["payment", "emoney", "wallet"]
base_score = 68
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: Crypto/NFT-ish identifiers (context-bound)
# - Not always "secret", but often sensitive and traceable.
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.crypto.eth_address.keyword"
description = "Ethereum address (keyword-bound; 0x + 40 hex)"
pattern = '''(?:NFT|token|mint|wallet|address|アドレス|ウォレット|コントラクト|contract)[^\n]{0,16}[:：]?[ 　]*(?:0x)?[0-9a-fA-F]{40}'''
severity = "LOW"
score = 40
category = "pii"
tags = ["crypto", "address", "eth"]
base_score = 40
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.crypto.base58_address.keyword"
description = "Base58 address (Solana-like) keyword-bound (32-44 chars)"
pattern = '''(?:NFT|token|mint|wallet|address|アドレス|ウォレット|公開鍵|public(?:\s*|_)?key)[^\n]{0,16}[:：]?[ 　]*[1-9A-HJ-NP-Za-km-z]{32,44}'''
severity = "LOW"
score = 40
category = "pii"
tags = ["crypto", "address", "base58"]
base_score = 40
context_lines_before = 1
context_lines_after = 1

[[rules]]
id = "pii.crypto.hash.keyword"
description = "Hash / signature (keyword-bound; hex 64)"
pattern = '''(?:hash|sha256|digest|signature|署名|ハッシュ|txhash|blockhash|transaction(?:\s*|_)?hash)[^\n]{0,16}[:：]?[ 　]*(?i)[0-9a-f]{64}'''
severity = "LOW"
score = 42
category = "pii"
tags = ["crypto", "hash"]
base_score = 42
context_lines_before = 1
context_lines_after = 1

# ------------------------------------------------------------------------------
# EXTRA: Stronger "unknown number => stop" gate (keyword-bound)
# ------------------------------------------------------------------------------

[[rules]]
id = "pii.heuristic.unknown_id_like.keyword"
description = "Unknown id-like token with strong keywords (gate++)."
pattern = '''(?:意味不明|不明|unknown|未分類|識別子|identifier|token|キー|key|ID|番号|No\.|コード|code)[^\n]{0,16}[:：]?[ 　]*[A-Za-z0-9][A-Za-z0-9\-_]{11,79}'''
severity = "MEDIUM"
score = 70
category = "pii"
tags = ["heuristic", "gate", "unknown"]
base_score = 70
context_lines_before = 1
context_lines_after = 1
